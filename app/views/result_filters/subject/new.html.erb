<%= content_for :page_title, "Find course by subject" %>

<% content_for :before_content do %>
  <%= govuk_back_link_to(results_path(@results_filter_query_parameters), "Back to search results") %>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= form_with(url: subject_path, method: :post) do |f| %>
      <%= render 'result_filters/hidden_fields', exclude_keys: ["subjects"], form: f %>
      <fieldset class="govuk-fieldset">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--xl">
          <h1 class="govuk-heading-xl">Find courses by subject</h1>
        </legend>
        <p class="govuk-body">Select the subjects you want to teach.</p>
        <h2 class="govuk-heading-m">Get financial support</h2>
        <p class="govuk-body">Youâ€™ll have to pay a fee for most courses. You can get financial support to cover this, and to help with your living costs while you study. The amount of financial support available to you will depend on the subject you choose.</p>
        <p class="govuk-body">Visit Get into Teaching to find out more about <%= govuk_link_to "postgraduate loans", "https://getintoteaching.education.gov.uk/funding-and-salary/overview/postgraduate-loans" %>, <%= govuk_link_to "bursaries and scholarships", "https://getintoteaching.education.gov.uk/funding-and-salary/overview" %>, and <%= govuk_link_to "funding by subject", "https://getintoteaching.education.gov.uk/funding-and-salary/overview/funding-by-subject" %>.</p>


        <div class="accordion govuk-form-group" data-module="govuk-accordion">
          <% @subject_areas.each do |subject_area| %>
            <div class="govuk-accordion__section" data-qa="subject_area">
              <div class="govuk-accordion__section-header">
                <h2 class="govuk-accordion__section-heading" data-qa="subject_area__name">
                  <button type="button" data-qa="subject_area__accordion_button" id="accordion-heading-<%= subject_area.typename %>" aria-controls="null-content-1" class="govuk-accordion__section-button" aria-expanded="<%= if subject_area_is_selected?(subject_area: subject_area) then "true" else "false" end %>">
                    <%= subject_area.name %>
                  </button>
                </h2>
                <span class="govuk-accordion__icon" aria-hidden="true"></span>
              </div>
              <div class="govuk-accordion__section-content" aria-labelledby="accordion-heading-<%= subject_area.typename.downcase %>">
                <div class="govuk-checkboxes">
                  <% subject_area.subjects.sort_by{ |subject| subject.subject_name }.each do |subject| %>
                    <%# C# doesn't have a distinct modern languages subject %>
                    <% unless subject.subject_name == "Modern Languages" || subject.subject_name == "Philosophy" %>
                      <div class="govuk-checkboxes__item" data-qa="subject">
                        <%= f.check_box(:subjects, { multiple: true, checked: subject_is_selected?(id: subject.id), data: {qa: "subject__checkbox"}, id: "subject#{subject.id}", class: "govuk-checkboxes__input" }, subject.id, nil) %>
                          <%= f.label(:subjects, {for: "subject#{subject.id}", data: {qa: "subject__name"}}, class: "govuk-label govuk-checkboxes__label") do %>
                          <span class="govuk-checkboxes__label-text">
                            <%= subject.subject_name %>
                          </span>
                          <span class="govuk-!-display-block"></span>
                        <% end %>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
          <div class="govuk-accordion__section" data-qa="send_area">
            <div class="govuk-accordion__section-header">
              <h2 class="govuk-accordion__section-heading" data-qa="subject_area__name">
                <button type="button" data-qa="subject_area__accordion_button" id="accordion-heading-send" aria-controls="null-content-1" class="govuk-accordion__section-button" aria-expanded="<%= if params[:senCourses] == "true" then "true" else "false" end %>">
                  Special educational needs and disability (SEND)
                </button>
              </h2>
              <span class="govuk-accordion__icon" aria-hidden="true"></span>
            </div>
            <div class="govuk-accordion__section-content" aria-labelledby="accordion-heading-send">
              <div class="govuk-checkboxes">
                <div class="govuk-checkboxes__item" data-qa="subject">
                  <%= f.check_box(:senCourses, { checked: params[:senCourses] == "true", data: {qa: "subject__checkbox"}, id: "subject_send", class: "govuk-checkboxes__input" }, 'true', nil) %>
                  <%= f.label(:subjects, {for: "subject_send", data: {qa: "subject__name"}}, class: "govuk-label govuk-checkboxes__label") do %>
                    <span class="govuk-checkboxes__label-text">
                      Show only courses with a <abbr title="Special educational needs and disability">SEND</abbr> specialism
                    </span>
                    <span class="govuk-!-display-block"></span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <%= f.submit("Find courses", name: nil, data: {qa: "continue"}, class: "govuk-button" )%>
      </fieldset>
    <% end %>
  </div>
</div>
